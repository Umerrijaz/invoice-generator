<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>Invoice Generator - Mobile Friendly</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        @page {
            size: A4;
            margin: 15mm;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
            padding: 10px;
            max-width: 210mm;
            margin: 0 auto;
            -webkit-text-size-adjust: 100%; /* Prevent font scaling on iOS */
            -webkit-tap-highlight-color: transparent;
        }

        /* Prevent zoom on input focus for mobile */
        @media screen and (max-width: 599px) {
            input, select, textarea {
                font-size: 16px !important; /* 16px prevents iOS zoom */
            }
            
            /* Better mobile spacing */
            .terms-section h5 {
                margin-top: 12px;
            }
            
            .terms-section li {
                margin-bottom: 5px;
            }
            
            .container {
                padding: 16px;
            }
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }

        .header {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 18px;
            padding-bottom: 14px;
            border-bottom: 3px solid #2c3e50;
            gap: 15px;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 15px;
            flex: 1 1 100%;
            min-width: 0;
        }

        .logo {
            width: 70px;
            height: 70px;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            border: 2px solid #ddd;
            flex-shrink: 0;
            overflow: hidden;
            padding: 8px;
        }

        .logo img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            object-position: center;
            display: block;
        }

        .logo-text {
            font-size: 24px;
            color: #3498db;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
        }

        .company-info h1 {
            color: #2c3e50;
            font-size: 18px;
            margin-bottom: 4px;
        }

        .company-info p {
            color: #7f8c8d;
            font-size: 12px;
            line-height: 1.3;
        }

        .invoice-title {
            text-align: right;
            flex-shrink: 0;
            width: 100%;
            min-width: 0;
            margin-top: 10px;
        }

        .invoice-title h2 {
            color: #2c3e50;
            font-size: 24px;
            margin-bottom: 8px;
            text-align: right;
        }

        .invoice-title .date-container {
            display: flex;
            align-items: center;
            justify-content: flex-end;
            gap: 8px;
            flex-wrap: wrap;
        }

        .invoice-title .date-label {
            color: #7f8c8d;
            font-size: 13px;
            font-weight: 600;
        }

        .invoice-title input[type="date"] {
            border: 1px solid #ddd;
            padding: 6px 8px;
            border-radius: 4px;
            font-size: 13px;
            color: #2c3e50;
            background: white;
        }

        .input-section {
            display: grid;
            grid-template-columns: 1fr;
            gap: 14px;
            margin-bottom: 18px;
        }

        .input-group {
            margin-bottom: 0;
        }

        .input-group label {
            display: block;
            margin-bottom: 5px;
            color: #2c3e50;
            font-weight: 600;
            font-size: 13px;
        }

        .input-group input,
        .input-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px; /* Prevent zoom on iOS */
            background: white;
            transition: none; /* Remove transitions that cause jitter */
            -webkit-tap-highlight-color: transparent;
        }

        .input-group input:focus,
        .input-group select:focus {
            outline: none;
            border-color: #3498db;
        }

        /* Mobile-optimized select dropdown */
        .input-group select {
            cursor: pointer;
            /* Use native dropdown on mobile for better UX */
            appearance: auto;
            -webkit-appearance: menulist;
            -moz-appearance: menulist;
            height: 42px; /* Fixed height prevents jitter */
            line-height: normal;
            touch-action: manipulation;
        }

        /* Desktop-only custom styling */
        @media (min-width: 600px) {
            .input-group select {
                appearance: none;
                -webkit-appearance: none;
                -moz-appearance: none;
                background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
                background-repeat: no-repeat;
                background-position: right 8px center;
                background-size: 16px;
                padding-right: 32px;
            }
            
            .input-group input,
            .input-group select {
                font-size: 13px;
                padding: 8px;
            }
        }

        .products-section {
            margin-bottom: 18px;
        }

        .products-section h3 {
            color: #2c3e50;
            margin-bottom: 12px;
            font-size: 16px;
            font-weight: 700;
        }

        .table-container {
            width: 100%;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            margin-bottom: 10px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 100%;
        }

        th {
            background: #2c3e50;
            color: white;
            padding: 8px 5px;
            text-align: left;
            font-weight: 600;
            font-size: 12px;
            white-space: nowrap;
        }

        td {
            padding: 6px 5px;
            border-bottom: 1px solid #ecf0f1;
            vertical-align: middle;
        }

        td input {
            width: 100%;
            padding: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 12px;
            min-width: 60px;
        }

        .product-name-input {
            min-width: 120px;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: background 0.3s;
            width: 100%;
        }

        .btn-add {
            background: #27ae60;
            color: white;
            margin-bottom: 10px;
        }

        .btn-add:hover {
            background: #229954;
        }

        .btn-remove {
            background: #e74c3c;
            color: white;
            padding: 5px 8px;
            width: auto;
            font-size: 16px;
            line-height: 1;
            min-width: 28px;
        }

        .btn-remove:hover {
            background: #c0392b;
        }

        .summary {
            margin-top: 18px;
        }

        .summary-box {
            width: 100%;
            background: #ecf0f1;
            padding: 14px;
            border-radius: 4px;
            border: 1px solid #d5dbdb;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            font-size: 13px;
            gap: 10px;
        }

        .summary-row-label {
            flex: 1;
            text-align: left;
            color: #34495e;
            font-weight: 500;
        }

        .summary-row-value {
            flex: 1;
            text-align: right;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            gap: 5px;
            color: #2c3e50;
            font-weight: 500;
        }

        .summary-row input {
            width: 90px;
            text-align: right;
            padding: 6px 8px;
            border: 1px solid #bdc3c7;
            border-radius: 4px;
            font-size: 13px;
            font-weight: 500;
        }

        .summary-row.total {
            border-top: 2px solid #2c3e50;
            padding-top: 12px;
            margin-top: 12px;
            margin-bottom: 10px;
            font-size: 16px;
            font-weight: bold;
            color: #2c3e50;
        }

        .summary-row.balance-due {
            font-size: 16px;
            font-weight: bold;
            color: #e74c3c;
            background: #ffe5e5;
            padding: 10px;
            margin: 10px -14px -14px -14px;
            border-radius: 0 0 4px 4px;
        }

        .note-section {
            margin-top: 18px;
            padding: 12px;
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            border-radius: 4px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }

        .note-section h4 {
            color: #856404;
            margin-bottom: 6px;
            font-size: 13px;
            font-weight: 700;
        }

        .note-section p {
            color: #856404;
            font-size: 11px;
            line-height: 1.6;
        }

        .terms-section {
            margin-top: 18px;
            padding: 14px;
            background: #f8f9fa;
            border-radius: 4px;
            border: 1px solid #e9ecef;
        }

        .terms-section h4 {
            color: #495057;
            margin-bottom: 10px;
            font-size: 14px;
            font-weight: 700;
            border-bottom: 2px solid #dee2e6;
            padding-bottom: 6px;
        }

        .terms-section h5 {
            color: #495057;
            margin-top: 10px;
            margin-bottom: 5px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        .terms-section p,
        .terms-section ul {
            color: #6c757d;
            font-size: 10px;
            line-height: 1.6;
            margin-bottom: 6px;
        }

        .terms-section ul {
            margin-left: 18px;
            margin-top: 4px;
            padding-left: 4px;
        }

        .terms-section li {
            margin-bottom: 4px;
            padding-left: 2px;
        }
        
        .terms-section li:last-child {
            margin-bottom: 0;
        }

        .actions {
            margin-top: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .btn-pdf {
            background: #3498db;
            color: white;
        }

        .btn-pdf:hover {
            background: #2980b9;
        }

        @media (min-width: 600px) {
            body {
                padding: 20px;
            }

            .container {
                padding: 25px;
            }

            .input-section {
                grid-template-columns: 1fr 1fr;
            }

            .btn-add {
                width: auto;
            }

            .logo-section {
                flex: 1 1 auto;
                min-width: 250px;
            }

            .invoice-title {
                flex: 0 0 auto;
                width: auto;
                min-width: 200px;
                margin-top: 0;
            }
        }

        @media print {
            @page {
                size: A4;
                margin: 6mm;
            }
            
            html, body {
                background: white !important;
                padding: 0 !important;
                margin: 0 !important;
                width: 100% !important;
                max-width: none !important;
                height: auto !important;
            }
            
            body {
                print-color-adjust: exact;
                -webkit-print-color-adjust: exact;
            }
            
            /* ULTRA CRITICAL: Hide EVERYTHING except the invoice container */
            body > *:not(.container) {
                display: none !important;
                visibility: hidden !important;
                position: absolute !important;
                left: -9999px !important;
                height: 0 !important;
                width: 0 !important;
                overflow: hidden !important;
                opacity: 0 !important;
            }
            
            .container {
                box-shadow: none !important;
                padding: 0 !important;
                max-width: none !important;
                margin: 0 !important;
                page-break-after: avoid !important;
                page-break-inside: avoid !important;
                display: block !important;
                visibility: visible !important;
            }
            
            /* Hide all buttons and interactive elements */
            .actions, .btn-add, .btn-remove, .logo-placeholder, .logo-upload,
            button, input[type="file"], #uploadBtn {
                display: none !important;
                visibility: hidden !important;
            }
            
            /* NUCLEAR OPTION: Hide any external content that might sneak in */
            a[href*="github"],
            a[href*="badge"],
            a[href*="fork"],
            footer,
            .footer,
            #footer,
            [class*="footer"],
            [id*="footer"],
            [class*="github"],
            [class*="badge"],
            [id*="github"],
            [id*="badge"],
            [id*="corner"],
            [class*="corner"],
            .github-corner,
            #github-corner,
            script,
            noscript,
            iframe,
            [class*="watermark"],
            [id*="watermark"] {
                display: none !important;
                visibility: hidden !important;
                position: absolute !important;
                left: -9999px !important;
                width: 0 !important;
                height: 0 !important;
                overflow: hidden !important;
                opacity: 0 !important;
                clip: rect(0,0,0,0) !important;
                clip-path: inset(100%) !important;
            }
            
            /* Make inputs look like regular text */
            input, select {
                border: none !important;
                background: transparent !important;
                -webkit-appearance: none;
                appearance: none;
                padding: 0 !important;
                color: inherit !important;
            }
            
            input[type="date"] {
                color: #2c3e50 !important;
            }
            
            .table-container {
                overflow: visible;
            }
            
            /* Compact header */
            .header {
                margin-bottom: 3px;
                padding-bottom: 3px;
                page-break-inside: avoid;
            }
            
            .invoice-title {
                min-width: auto;
            }
            
            .invoice-title h2 {
                font-size: 16px;
                margin-bottom: 2px;
            }
            
            .invoice-title .date-container {
                font-size: 9px;
            }
            
            .invoice-title .date-label {
                font-size: 9px;
            }
            
            .invoice-title input[type="date"] {
                font-size: 9px;
                padding: 0 !important;
            }
            
            .logo {
                width: 40px;
                height: 40px;
                font-size: 14px;
                border-radius: 50%;
                padding: 4px;
            }
            
            .logo img {
                object-fit: contain;
                object-position: center;
            }
            
            .company-info h1 {
                font-size: 13px;
                margin-bottom: 1px;
            }
            
            .company-info p {
                font-size: 8px;
                line-height: 1.1;
            }
            
            .input-section {
                margin-bottom: 3px;
                gap: 2px;
            }
            
            .input-group {
                margin-bottom: 0;
            }
            
            .input-group label {
                font-size: 8px;
                margin-bottom: 1px;
            }
            
            .input-group input, .input-group select {
                font-size: 8px;
                padding: 0 !important;
            }
            
            .products-section {
                margin-bottom: 3px;
            }
            
            .products-section h3 {
                font-size: 11px;
                margin-bottom: 2px;
            }
            
            th {
                padding: 3px 2px;
                font-size: 8px;
            }
            
            td {
                padding: 2px 2px;
                font-size: 8px;
            }
            
            td input {
                font-size: 8px;
                padding: 0 !important;
            }
            
            .summary {
                margin-top: 3px;
            }
            
            .summary-box {
                padding: 4px;
            }
            
            .summary-row {
                font-size: 8px;
                margin-bottom: 2px;
            }
            
            .summary-row input {
                font-size: 8px;
                padding: 0 !important;
                width: 60px;
            }
            
            .summary-row.total {
                font-size: 10px;
                padding-top: 3px;
                margin-top: 3px;
            }
            
            .summary-row.balance-due {
                font-size: 10px;
                padding: 4px;
                margin: 3px -4px -4px -4px;
            }
            
            .note-section {
                margin-top: 3px;
                padding: 4px;
            }
            
            .note-section h4 {
                font-size: 8px;
                margin-bottom: 1px;
            }
            
            .note-section p {
                font-size: 7px;
                line-height: 1.1;
            }
            
            .terms-section {
                margin-top: 3px;
                padding: 4px;
            }
            
            .terms-section h4 {
                font-size: 9px;
                margin-bottom: 2px;
            }
            
            .terms-section h5 {
                font-size: 7px;
                margin-top: 2px;
                margin-bottom: 1px;
            }
            
            .terms-section p,
            .terms-section ul {
                font-size: 6px;
                line-height: 1.1;
                margin-bottom: 1px;
            }
            
            .terms-section ul {
                margin-left: 10px;
                margin-top: 1px;
            }
            
            .terms-section li {
                margin-bottom: 0px;
            }
        }
    </style>
</head>
<body>
    <div class="container" id="invoice">
        <div class="header">
            <div class="logo-section">
                <div class="logo" id="logoContainer">
                    <div id="logoFallback" class="logo-text">ST</div>
                    <input type="file" id="logoUpload" style="display:none" accept="image/*">
                </div>
                <button onclick="document.getElementById('logoUpload').click()" id="uploadBtn" style="padding: 5px 10px; background: #3498db; color: white; border: none; border-radius: 4px; font-size: 11px; cursor: pointer; margin-left: 10px;">Upload Logo</button>
                <div class="company-info">
                    <h1>Shop Turkey</h1>
                    <p>Faisalabad, Pakistan</p>
                    <p>Instagram:_shopturkey</p>
                </div>
            </div>
            <div class="invoice-title">
                <h2>INVOICE</h2>
                <div class="date-container">
                    <span class="date-label">Date:</span>
                    <input type="date" id="invoiceDate">
                </div>
            </div>
        </div>

        <div class="input-section">
            <div class="input-group">
                <label>Customer Name:</label>
                <input type="text" id="customerName" placeholder="Enter customer name">
            </div>
            <div class="input-group">
                <label>Customer Phone:</label>
                <input type="text" id="customerPhone" placeholder="Enter phone number">
            </div>
            <div class="input-group">
                <label>Customer Address:</label>
                <input type="text" id="customerAddress" placeholder="Enter customer address">
            </div>
            <div class="input-group">
                <label>Payment Method:</label>
                <select id="paymentMethod" onchange="calculateTotal()">
                    <option value="Cash on Delivery">Cash on Delivery</option>
                    <option value="Advance Payment">Advance Payment</option>
                    <option value="Bank Transfer">Bank Transfer</option>
                </select>
            </div>
        </div>

        <div class="products-section">
            <h3>Products</h3>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th style="width: 40%">Product Name</th>
                            <th style="width: 15%">Qty</th>
                            <th style="width: 20%">Price</th>
                            <th style="width: 20%">Total</th>
                            <th style="width: 5%"></th>
                        </tr>
                    </thead>
                    <tbody id="productsTable">
                        <tr>
                            <td><input type="text" class="product-name product-name-input" placeholder="Product name"></td>
                            <td><input type="number" class="quantity" value="1" min="1" onchange="calculateTotal()"></td>
                            <td><input type="number" class="price" value="0" min="0" onchange="calculateTotal()"></td>
                            <td><input type="number" class="item-total" value="0" readonly></td>
                            <td><button class="btn btn-remove" onclick="removeRow(this)">×</button></td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <button class="btn btn-add" onclick="addRow()">+ Add Product</button>
        </div>

        <div class="summary">
            <div class="summary-box">
                <div class="summary-row">
                    <span class="summary-row-label">Subtotal:</span>
                    <span class="summary-row-value">PKR <span id="subtotal">0.00</span></span>
                </div>
                <div class="summary-row">
                    <span class="summary-row-label">Delivery Charges:</span>
                    <span class="summary-row-value">
                        PKR <input type="number" id="deliveryCharges" value="0" min="0" onchange="calculateTotal()">
                    </span>
                </div>
                <div class="summary-row" id="codTaxRow" style="display: none;">
                    <span class="summary-row-label">COD Tax (4%):</span>
                    <span class="summary-row-value">PKR <span id="codTax">0.00</span></span>
                </div>
                <div class="summary-row">
                    <span class="summary-row-label">Discount:</span>
                    <span class="summary-row-value">
                        PKR <input type="number" id="discount" value="0" min="0" onchange="calculateTotal()">
                    </span>
                </div>
                <div class="summary-row total">
                    <span class="summary-row-label">TOTAL:</span>
                    <span class="summary-row-value">PKR <span id="total">0.00</span></span>
                </div>
                <div class="summary-row">
                    <span class="summary-row-label">Amount Paid:</span>
                    <span class="summary-row-value">
                        PKR <input type="number" id="amountPaid" value="0" min="0" onchange="calculateTotal()">
                    </span>
                </div>
                <div class="summary-row balance-due">
                    <span class="summary-row-label">BALANCE DUE:</span>
                    <span class="summary-row-value">PKR <span id="balanceDue">0.00</span></span>
                </div>
            </div>
        </div>

        <div class="note-section">
            <h4>⚠️ Important Note:</h4>
            <p>Please make a video while opening the package so we can file claims in case of damaged or lost items.</p>
        </div>

        <div class="terms-section">
            <h4>Terms & Conditions</h4>
            
            <h5>Payment Policy</h5>
            <ul>
                <li>Our primary payment method is online bank transfer only.</li>
                <li>Preorders: A 50% advance payment via bank transfer is required to confirm the order.</li>
                <li>In-stock items: Full payment via bank transfer is required.</li>
                <li>Cash on Delivery (COD): Available on limited items only.</li>
                <li>A 4% tax is applicable on all Cash on Delivery parcels.</li>
            </ul>

            <h5>Delivery Timeline</h5>
            <ul>
                <li>In-stock items: Estimated delivery time is 2–7 working days.</li>
                <li>Preorders: Estimated delivery time is 2–4 weeks.</li>
                <li>Please note: Exact delivery dates cannot be guaranteed as delays may occur due to customs clearance.</li>
            </ul>

            <h5>Cancellations & Refunds</h5>
            <ul>
                <li>In case of order cancellation after the return period has passed, the advance payment is non-refundable.</li>
            </ul>

            <h5>Sizing & Specifications</h5>
            <ul>
                <li>Sizes, measurements, shades, and similar specifications are not our responsibility.</li>
                <li>No refunds or exchanges will be accommodated on the basis of sizing or similar concerns.</li>
            </ul>
        </div>

        <div class="actions">
            <button class="btn btn-pdf" onclick="generatePDF()">Save as PDF</button>
        </div>
    </div>
    
    <script>
        // Set today's date in the date input
        const today = new Date();
        const dateStr = today.toISOString().split('T')[0];
        document.getElementById('invoiceDate').value = dateStr;

        // Logo upload functionality
        document.getElementById('logoUpload').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file && file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const base64 = event.target.result;
                    
                    // Update the logo display
                    const logoContainer = document.getElementById('logoContainer');
                    logoContainer.innerHTML = `<img src="${base64}" alt="Shop Turkey Logo" style="width:100%;height:100%;object-fit:contain;">`;
                    
                    // Hide upload button
                    document.getElementById('uploadBtn').style.display = 'none';
                    
                    // Save to localStorage
                    localStorage.setItem('shopTurkeyLogoBase64', base64);
                    
                    alert('Logo uploaded successfully! It will be saved for future use.');
                };
                reader.readAsDataURL(file);
            }
        });

        // Load saved logo on page load
        window.addEventListener('DOMContentLoaded', function() {
            const savedLogo = localStorage.getItem('shopTurkeyLogoBase64');
            if (savedLogo) {
                const logoContainer = document.getElementById('logoContainer');
                logoContainer.innerHTML = `<img src="${savedLogo}" alt="Shop Turkey Logo" style="width:100%;height:100%;object-fit:contain;">`;
                document.getElementById('uploadBtn').style.display = 'none';
            }
        });

        function addRow() {
            const table = document.getElementById('productsTable');
            const newRow = table.insertRow();
            newRow.innerHTML = `
                <td><input type="text" class="product-name product-name-input" placeholder="Product name"></td>
                <td><input type="number" class="quantity" value="1" min="1" onchange="calculateTotal()"></td>
                <td><input type="number" class="price" value="0" min="0" onchange="calculateTotal()"></td>
                <td><input type="number" class="item-total" value="0" readonly></td>
                <td><button class="btn btn-remove" onclick="removeRow(this)">×</button></td>
            `;
            calculateTotal();
        }

        function removeRow(button) {
            const table = document.getElementById('productsTable');
            if (table.rows.length > 1) {
                button.parentElement.parentElement.remove();
                calculateTotal();
            }
        }

        function calculateTotal() {
            const rows = document.querySelectorAll('#productsTable tr');
            let subtotal = 0;

            rows.forEach(row => {
                const quantity = parseFloat(row.querySelector('.quantity').value) || 0;
                const price = parseFloat(row.querySelector('.price').value) || 0;
                const itemTotal = quantity * price;
                row.querySelector('.item-total').value = itemTotal.toFixed(2);
                subtotal += itemTotal;
            });

            const deliveryCharges = parseFloat(document.getElementById('deliveryCharges').value) || 0;
            const discountAmount = parseFloat(document.getElementById('discount').value) || 0;
            const paymentMethod = document.getElementById('paymentMethod').value;
            
            let codTax = 0;
            const codTaxRow = document.getElementById('codTaxRow');
            
            if (paymentMethod === 'Cash on Delivery') {
                codTax = (subtotal + deliveryCharges - discountAmount) * 0.04;
                codTaxRow.style.display = 'flex';
                document.getElementById('codTax').textContent = codTax.toFixed(2);
            } else {
                codTaxRow.style.display = 'none';
            }
            
            const amountPaid = parseFloat(document.getElementById('amountPaid').value) || 0;
            const total = subtotal + deliveryCharges - discountAmount + codTax;
            const balanceDue = total - amountPaid;

            document.getElementById('subtotal').textContent = subtotal.toFixed(2);
            document.getElementById('total').textContent = total.toFixed(2);
            document.getElementById('balanceDue').textContent = balanceDue.toFixed(2);
        }

        function generatePDF() {
            // Create a more aggressive cleanup for mobile
            const hideSelectors = [
                'footer', '.footer', '[class*="footer"]', '[id*="footer"]',
                '[class*="github"]', '[id*="github"]', 
                '[class*="badge"]', '[id*="badge"]',
                'a[href*="github"]', 'a[href*="badge"]', 'a[href*="fork"]',
                '[class*="corner"]', '[id*="corner"]',
                'iframe', '[class*="watermark"]', '[id*="watermark"]',
                'nav', '.nav', 'header:not(.header)', '.navigation'
            ];
            
            // First pass: hide by selector
            hideSelectors.forEach(selector => {
                try {
                    const elements = document.querySelectorAll(selector);
                    elements.forEach(el => {
                        if (el && !el.closest('.container')) {
                            el.remove(); // Actually remove it from DOM
                        }
                    });
                } catch (e) {
                    console.log('Selector error:', selector);
                }
            });
            
            // Second pass: hide all links outside container
            document.querySelectorAll('a').forEach(link => {
                if (!link.closest('.container')) {
                    link.remove();
                }
            });
            
            // Hide everything except the container
            const container = document.getElementById('invoice');
            const bodyChildren = Array.from(document.body.children);
            bodyChildren.forEach(child => {
                if (child !== container && child.tagName !== 'SCRIPT' && child.tagName !== 'STYLE') {
                    child.remove(); // Remove from DOM entirely
                }
            });
            
            // Ensure container is visible
            container.style.display = 'block';
            container.style.visibility = 'visible';
            
            // Add a slight delay for mobile browsers
            setTimeout(() => {
                window.print();
            }, 100);
        }

        calculateTotal();
    </script>
</body>
</html>
